<?xml version="1.0" encoding="utf-8" ?>
<sf:PageBase x:Class="Starward.Features.Background.BackgroundViewPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lang="using:Starward.Language"
             xmlns:local="using:Starward.Features.Background"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mxi="using:Microsoft.Xaml.Interactivity"
             xmlns:s="using:Starward"
             xmlns:sc="using:Starward.Controls"
             xmlns:sf="using:Starward.Frameworks"
             xmlns:sh="using:Starward.Helpers"
             xmlns:ui="using:CommunityToolkit.WinUI"
             x:DefaultBindMode="OneWay"
             mc:Ignorable="d">

    <Page.Resources>
        <FontFamily x:Key="PhotoFluentIcons">ms-appx:///Assets/Font/PhotosIcons.ttf#Photos Fluent Icons</FontFamily>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <StackPanel Margin="24,2,24,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Top"
                    Orientation="Horizontal"
                    Spacing="12">
            <!--  打开文件夹  -->
            <Button Command="{x:Bind OpenFolderCommand}" Content="{x:Bind lang:Lang.ScreenshotPage_OpenFolder}" />
            <!--  删除重复文件  -->
            <Button Command="{x:Bind DeleteDuplicateBgCommand}" Content="{x:Bind lang:Lang.BackgroundViewPage_DeleteDuplicateFiles}" />
            <!--  多选  -->
            <ToggleButton x:Name="ToggleButton_MultiSelect"
                          Content="{x:Bind lang:Lang.ScreenshotPage_MultiSelect}"
                          IsChecked="{x:Bind MutliSelect, Mode=TwoWay}" />
            <TextBlock x:Name="TextBlock_SelectCount"
                       VerticalAlignment="Center"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Text="{x:Bind SelectCountText}" />
            <TextBlock x:Name="TextBlock_DeleteInfo"
                       VerticalAlignment="Center"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Text="{x:Bind DeleteInfoText}" />
        </StackPanel>
        <!--  功能提醒  -->
        <StackPanel Margin="24,2,32,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Orientation="Horizontal"
                    Spacing="12">
            <Button Padding="4" Style="{ThemeResource DateTimePickerFlyoutButtonStyle}">
                <FontIcon FontSize="14"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                          Glyph="&#xE946;" />
                <Button.Flyout>
                    <Flyout>
                        <StackPanel MaxWidth="420" Spacing="8">
                            <TextBlock Text="{x:Bind lang:Lang.BackgroundViewPage_DeleteDuplicateFilesTip}" TextWrapping="Wrap" />
                            <TextBlock Text="{x:Bind lang:Lang.BackgroundViewPage_VP9VideoExtensionsTip}" TextWrapping="Wrap" />
                        </StackPanel>
                    </Flyout>
                </Button.Flyout>
            </Button>
            <!--  筛选  -->
            <Button>
                <StackPanel Orientation="Horizontal" Spacing="6">
                    <FontIcon Margin="0,2,0,0"
                              FontSize="14"
                              Glyph="&#xE71C;" />
                    <TextBlock Text="{x:Bind lang:Lang.Common_Filter}" />
                </StackPanel>
                <Button.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <RadioMenuFlyoutItem x:Name="RadioMenuFlyoutItem_Filter_All"
                                             Click="RadioMenuFlyoutItem_FilterSort_Click"
                                             GroupName="Filter"
                                             IsChecked="True"
                                             Text="{x:Bind lang:Lang.Common_All}" />
                        <RadioMenuFlyoutItem x:Name="RadioMenuFlyoutItem_Filter_Image"
                                             Click="RadioMenuFlyoutItem_FilterSort_Click"
                                             GroupName="Filter"
                                             Text="{x:Bind lang:Lang.FileSettingPage_Image}" />
                        <RadioMenuFlyoutItem x:Name="RadioMenuFlyoutItem_Filter_Video"
                                             Click="RadioMenuFlyoutItem_FilterSort_Click"
                                             GroupName="Filter"
                                             Text="{x:Bind lang:Lang.Common_Video}" />
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
            <!--  排序  -->
            <Button>
                <StackPanel Orientation="Horizontal" Spacing="6">
                    <FontIcon Margin="0,2,0,0"
                              FontSize="14"
                              Glyph="&#xE8CB;" />
                    <TextBlock Text="{x:Bind lang:Lang.Common_Sort}" />
                </StackPanel>
                <Button.Flyout>
                    <MenuFlyout Placement="Bottom">
                        <RadioMenuFlyoutItem x:Name="RadioMenuFlyoutItem_Sort_Time"
                                             Click="RadioMenuFlyoutItem_FilterSort_Click"
                                             GroupName="Sort"
                                             IsChecked="True"
                                             Text="{x:Bind lang:Lang.Common_Time}" />
                        <RadioMenuFlyoutItem x:Name="RadioMenuFlyoutItem_Sort_FileSize"
                                             Click="RadioMenuFlyoutItem_FilterSort_Click"
                                             GroupName="Sort"
                                             Text="{x:Bind lang:Lang.Common_FileSize}" />
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </StackPanel>

        <!--  文件夹不存在  -->
        <StackPanel Name="StackPanel_NoFolder"
                    Grid.RowSpan="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="16"
                    Visibility="Collapsed">
            <TextBlock HorizontalAlignment="Center"
                       FontSize="16"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Text="{x:Bind lang:Lang.DownloadGamePage_TheFolderDoesNotExist}" />
        </StackPanel>



        <GridView x:Name="GridView_Images"
                  Grid.Row="1"
                  Padding="24,0,12,12"
                  CanDragItems="{x:Bind s:AppConfig.IsAdmin, Converter={StaticResource BoolReversedConverter}}"
                  DragItemsStarting="GridView_Images_DragItemsStarting"
                  IsItemClickEnabled="True"
                  ItemClick="GridView_Images_ItemClick"
                  ItemsSource="{x:Bind BackgroundImages, FallbackValue={x:Null}}"
                  SelectionChanged="GridView_Images_SelectionChanged"
                  SelectionMode="None">
            <GridView.ItemContainerStyle>
                <Style BasedOn="{StaticResource DefaultGridViewItemStyle}" TargetType="GridViewItem">
                    <Setter Property="Margin" Value="0,0,12,12" />
                    <Setter Property="CornerRadius" Value="4" />
                </Style>
            </GridView.ItemContainerStyle>
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid AreStickyGroupHeadersEnabled="False"
                                   ItemHeight="136"
                                   ItemWidth="228"
                                   Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="local:BackgroundFileItem">
                    <Grid Name="Grid_ImageItem"
                          sh:PointerCursor.CursorShape="Hand"
                          ui:UIElementExtensions.ClipToBounds="True">
                        <sc:CachedImage Name="Image_Thumb"
                                        Width="216"
                                        Height="122"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        ui:VisualExtensions.NormalizedCenterPoint="0.5"
                                        Background="{ThemeResource ControlAltFillColorTertiaryBrush}"
                                        IsThumbnail="True"
                                        PngThumbnail="True"
                                        RenderTransformOrigin="0.5,0.5"
                                        Source="{x:Bind FilePath}"
                                        Stretch="UniformToFill">
                            <sc:CachedImage.RenderTransform>
                                <ScaleTransform />
                            </sc:CachedImage.RenderTransform>
                        </sc:CachedImage>
                        <Grid Padding="4,2,4,2"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Top"
                              Background="{ThemeResource ControlOnImageFillColorDefaultBrush}"
                              CornerRadius="4,0,4,4"
                              Visibility="{x:Bind IsVideo}">
                            <FontIcon FontFamily="{StaticResource PhotoFluentIcons}"
                                      FontSize="20"
                                      Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                      Glyph="&#xF411;" />
                        </Grid>
                        <!--  右键菜单  -->
                        <Grid.ContextFlyout>
                            <MenuFlyout>
                                <MenuFlyout.MenuFlyoutPresenterStyle>
                                    <Style BasedOn="{StaticResource DefaultMenuFlyoutPresenterStyle}" TargetType="MenuFlyoutPresenter">
                                        <Setter Property="BorderThickness" Value="0" />
                                    </Style>
                                </MenuFlyout.MenuFlyoutPresenterStyle>
                                <!--  文件格式，文件大小，像素大小  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_ScreenshotInfo"
                                                MinWidth="208"
                                                FontSize="12"
                                                IsEnabled="False"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind FileInfo}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE946;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <!--  打开  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_Open"
                                                Click="MenuFlyoutItem_Open_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.Common_Open}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE8A7;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  打开方式  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_OpenWith"
                                                Click="MenuFlyoutItem_OpenWith_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_OpenWith}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE7AC;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  复制文件  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_CopyFile"
                                                Click="MenuFlyoutItem_CopyFile_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_CopyFile}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE8C8;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <!--  在资源管理器中打开  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_OpenInExplorer"
                                                Click="MenuFlyoutItem_OpenInExplorer_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_OpenInExplorer}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xEC50;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  删除  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_Delete"
                                                Click="MenuFlyoutItem_Delete_Click"
                                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.Common_Delete}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE74D;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                    <MenuFlyoutItem.Resources>
                                        <StaticResource x:Key="MenuFlyoutItemForegroundPointerOver" ResourceKey="SystemFillColorCriticalBrush" />
                                        <StaticResource x:Key="MenuFlyoutItemForegroundPressed" ResourceKey="SystemFillColorCriticalBrush" />
                                    </MenuFlyoutItem.Resources>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </Grid.ContextFlyout>
                        <Grid.Resources>
                            <CircleEase x:Key="CircleEase" EasingMode="EaseOut" />
                            <Storyboard x:Key="GridZoomInStoryboard">
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1.15"
                                                 Duration="0:0:0.3" />
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1.15"
                                                 Duration="0:0:0.3" />
                            </Storyboard>
                            <Storyboard x:Key="GridZoomOutStoryboard">
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1"
                                                 Duration="0:0:0.6" />
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1"
                                                 Duration="0:0:0.6" />
                            </Storyboard>
                        </Grid.Resources>
                        <mxi:Interaction.Behaviors>
                            <mxi:EventTriggerBehavior EventName="PointerEntered">
                                <mxi:ControlStoryboardAction Storyboard="{StaticResource GridZoomInStoryboard}" />
                            </mxi:EventTriggerBehavior>
                            <mxi:EventTriggerBehavior EventName="PointerExited">
                                <mxi:ControlStoryboardAction Storyboard="{StaticResource GridZoomOutStoryboard}" />
                            </mxi:EventTriggerBehavior>
                        </mxi:Interaction.Behaviors>
                    </Grid>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>



    </Grid>

</sf:PageBase>
