<sf:PageBase x:Class="Starward.Features.Screenshot.ScreenshotPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:lang="using:Starward.Language"
             xmlns:local="using:Starward.Features.Screenshot"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:mxi="using:Microsoft.Xaml.Interactivity"
             xmlns:s="using:Starward"
             xmlns:sc="using:Starward.Controls"
             xmlns:sf="using:Starward.Frameworks"
             xmlns:sh="using:Starward.Helpers"
             xmlns:ui="using:CommunityToolkit.WinUI"
             x:DefaultBindMode="OneWay"
             mc:Ignorable="d">


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="44" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <TextBlock Margin="24,0,0,0"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Center"
                   FontSize="20"
                   FontWeight="Bold"
                   Text="{x:Bind lang:Lang.ScreenshotPage_GameScreenshot}" />


        <StackPanel Margin="0,0,28,0"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="12">
            <ToggleButton x:Name="ToggleButton_MultiSelect"
                          Content="{x:Bind lang:Lang.ScreenshotPage_MultiSelect}"
                          IsChecked="{x:Bind MutliSelect, Mode=TwoWay}" />
            <Button Command="{x:Bind ManageScreenshotFolderCommand}" Content="{x:Bind lang:Lang.ScreenshotPage_ManageScreenshotFolders}" />
        </StackPanel>


        <StackPanel Name="StackPanel_Emoji"
                    Grid.RowSpan="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="16"
                    Visibility="Collapsed">
            <Image Name="Image_Emoji"
                   Width="160"
                   Height="160" />
            <TextBlock HorizontalAlignment="Center"
                       FontSize="16"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Text="{x:Bind lang:Lang.ScreenshotPage_ScreenshotFolderDoesNotExist}" />
        </StackPanel>



        <GridView x:Name="GridView_Images"
                  Grid.Row="1"
                  Padding="24,0,12,12"
                  CanDragItems="{x:Bind s:AppConfig.IsAdmin, Converter={StaticResource BoolReversedConverter}}"
                  DragItemsStarting="GridView_Images_DragItemsStarting"
                  IsItemClickEnabled="True"
                  ItemClick="GridView_Images_ItemClick"
                  ItemsSource="{x:Bind ScreenshotViewSource.View, FallbackValue={x:Null}}"
                  SelectionMode="None">
            <GridView.GroupStyle>
                <GroupStyle>
                    <GroupStyle.HeaderContainerStyle>
                        <Style TargetType="GridViewHeaderItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <!--  Remove default rectangle border  -->
                                    <ControlTemplate TargetType="ContentControl">
                                        <ContentPresenter HorizontalAlignment="Stretch"
                                                          VerticalAlignment="Center"
                                                          Content="{TemplateBinding Content}"
                                                          ContentTemplate="{TemplateBinding ContentTemplate}" />
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </GroupStyle.HeaderContainerStyle>
                    <GroupStyle.HeaderTemplate>
                        <DataTemplate x:DataType="local:ScreenshotItemGroup">
                            <TextBlock FontSize="14"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       IsTextScaleFactorEnabled="False"
                                       Text="{x:Bind Header}" />
                        </DataTemplate>
                    </GroupStyle.HeaderTemplate>
                </GroupStyle>
            </GridView.GroupStyle>
            <GridView.ItemContainerStyle>
                <Style BasedOn="{StaticResource DefaultGridViewItemStyle}" TargetType="GridViewItem">
                    <Setter Property="Margin" Value="0,0,12,12" />
                    <Setter Property="CornerRadius" Value="4" />
                </Style>
            </GridView.ItemContainerStyle>
            <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid AreStickyGroupHeadersEnabled="False"
                                   ItemHeight="128"
                                   ItemWidth="218"
                                   Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </GridView.ItemsPanel>
            <GridView.ItemTemplate>
                <DataTemplate x:DataType="local:ScreenshotItem">
                    <Grid Name="Grid_ImageItem"
                          sh:PointerCursor.CursorShape="Hand"
                          ui:UIElementExtensions.ClipToBounds="True">
                        <sc:CachedImage Name="Image_Thumb"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        ui:VisualExtensions.NormalizedCenterPoint="0.5"
                                        Background="{ThemeResource ControlAltFillColorTertiaryBrush}"
                                        IsThumbnail="True"
                                        RenderTransformOrigin="0.5,0.5"
                                        Source="{x:Bind FilePath}"
                                        Stretch="UniformToFill">
                            <sc:CachedImage.RenderTransform>
                                <ScaleTransform />
                            </sc:CachedImage.RenderTransform>
                        </sc:CachedImage>
                        <Grid.ContextFlyout>
                            <MenuBarItemFlyout>
                                <MenuBarItemFlyout.MenuFlyoutPresenterStyle>
                                    <Style BasedOn="{StaticResource DefaultMenuFlyoutPresenterStyle}" TargetType="MenuFlyoutPresenter">
                                        <Setter Property="BorderThickness" Value="0" />
                                    </Style>
                                </MenuBarItemFlyout.MenuFlyoutPresenterStyle>
                                <!--  图片信息  -->
                                <MenuFlyoutItem IsEnabled="False" Text="{x:Bind FileInfo}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE946;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <!--  复制文件  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_CopyFile"
                                                Click="MenuFlyoutItem_CopyFile_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_CopyFile}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE8C8;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  复制为 JPG  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_CopyAsJPG"
                                                Click="MenuFlyoutItem_CopyAsJPG_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_CopyAsJPG}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xF413;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <!--  在资源管理器中打开  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_OpenInExplorer"
                                                Click="MenuFlyoutItem_OpenInExplorer_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_OpenInExplorer}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xEC50;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  使用默认应用打开  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_OpenWithDefault"
                                                Click="MenuFlyoutItem_OpenWithDefault_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_OpenWithDefaultApp}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE91B;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <!--  打开方式  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_OpenWith"
                                                Click="MenuFlyoutItem_OpenWith_Click"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.ImageViewWindow2_OpenWith}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE7AC;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <!--  删除  -->
                                <MenuFlyoutItem x:Name="MenuFlyoutItem_Delete"
                                                Click="MenuFlyoutItem_Delete_Click"
                                                Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                                IsTextScaleFactorEnabled="False"
                                                Text="{x:Bind lang:Lang.Common_Delete}">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE74D;" IsTextScaleFactorEnabled="False" />
                                    </MenuFlyoutItem.Icon>
                                    <MenuFlyoutItem.Resources>
                                        <StaticResource x:Key="MenuFlyoutItemForegroundPointerOver" ResourceKey="SystemFillColorCriticalBrush" />
                                        <StaticResource x:Key="MenuFlyoutItemForegroundPressed" ResourceKey="SystemFillColorCriticalBrush" />
                                    </MenuFlyoutItem.Resources>
                                </MenuFlyoutItem>
                            </MenuBarItemFlyout>
                        </Grid.ContextFlyout>
                        <Grid.Resources>
                            <CircleEase x:Key="CircleEase" EasingMode="EaseOut" />
                            <Storyboard x:Key="GridZoomInStoryboard">
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1.15"
                                                 Duration="0:0:0.3" />
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1.15"
                                                 Duration="0:0:0.3" />
                            </Storyboard>
                            <Storyboard x:Key="GridZoomOutStoryboard">
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                                 To="1"
                                                 Duration="0:0:0.6" />
                                <DoubleAnimation EasingFunction="{StaticResource CircleEase}"
                                                 Storyboard.TargetName="Image_Thumb"
                                                 Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                                 To="1"
                                                 Duration="0:0:0.6" />
                            </Storyboard>
                        </Grid.Resources>
                        <mxi:Interaction.Behaviors>
                            <mxi:EventTriggerBehavior EventName="PointerEntered">
                                <mxi:ControlStoryboardAction Storyboard="{StaticResource GridZoomInStoryboard}" />
                            </mxi:EventTriggerBehavior>
                            <mxi:EventTriggerBehavior EventName="PointerExited">
                                <mxi:ControlStoryboardAction Storyboard="{StaticResource GridZoomOutStoryboard}" />
                            </mxi:EventTriggerBehavior>
                        </mxi:Interaction.Behaviors>
                    </Grid>
                </DataTemplate>
            </GridView.ItemTemplate>
        </GridView>


    </Grid>
</sf:PageBase>
